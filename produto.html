<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="UTF-8">
    <title>Hermano Info - Detalhes</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .product-page { display: grid; grid-template-columns: 1fr 1fr; gap: 40px; margin-top: 40px; }
        .product-images { display: flex; flex-direction: column; gap: 10px; }
        .main-img { width: 100%; height: 400px; object-fit: cover; border-radius: 15px; border: 1px solid var(--glass-border); }
        .thumb-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .thumb-img { width: 100%; height: 80px; object-fit: cover; cursor: pointer; border-radius: 5px; opacity: 0.6; transition: 0.3s; border: 1px solid transparent; }
        .thumb-img:hover { opacity: 1; border-color: var(--primary-color); }
        .info-box { background: rgba(255,255,255,0.03); padding: 30px; border-radius: 20px; border: 1px solid var(--glass-border); }
        
        .qtd-container {
            display: flex; align-items: center; gap: 15px; margin: 20px 0;
            padding: 15px; background: rgba(255,255,255,0.05); border-radius: 10px;
        }
        .qtd-container input {
            width: 70px; padding: 8px; background: #000; border: 1px solid #444;
            color: #fff; text-align: center; font-size: 1.1rem; border-radius: 5px;
        }
        
        .frete-box { margin-top: 20px; padding: 15px; background: rgba(0, 212, 255, 0.05); border-radius: 10px; }

        @media (max-width: 768px) {
            .product-page { grid-template-columns: 1fr; gap: 20px; margin-top: 20px; padding: 15px; }
            .main-img { height: 300px; }
        }
    </style>
</head>
<body>
    <header>
        <h1 class="logo">HERMANO INFO</h1>
        <nav><a href="loja.html"><i class="fas fa-arrow-left"></i> Voltar</a></nav>
    </header>

    <main class="product-page" id="detalhe-produto">
        </main>

    <script>
        // CHAVE PADRONIZADA
        const DATABASE_KEY = 'produtos_loja';
        const urlParams = new URLSearchParams(window.location.search);
        const produtoId = urlParams.get('id');

        function carregarProduto() {
            const produtos = JSON.parse(localStorage.getItem(DATABASE_KEY)) || [];
            const produto = produtos.find(p => p.id == produtoId);

            if (!produto) {
                document.getElementById('detalhe-produto').innerHTML = "<h1 style='text-align:center; grid-column: span 2;'>Produto não encontrado</h1>";
                return;
            }

            document.getElementById('detalhe-produto').innerHTML = `
                <div class="product-images">
                    <img src="${produto.img1}" class="main-img" id="grande">
                    <div class="thumb-grid">
                        <img src="${produto.img1}" class="thumb-img" onclick="document.getElementById('grande').src=this.src">
                        <img src="${produto.img2 || produto.img1}" class="thumb-img" onclick="document.getElementById('grande').src=this.src">
                    </div>
                </div>
                <div class="info-box">
                    <h1 style="font-family: 'Orbitron'; color: #00d4ff;">${produto.nome}</h1>
                    <p style="color: #ccc; line-height: 1.6; margin: 20px 0; white-space: pre-wrap;">${produto.detalhes || 'Sem descrição adicional.'}</p>
                    
                    <h2 style="color: #fff; font-size: 2.5rem; margin: 10px 0;">R$ ${Number(produto.preco).toFixed(2)}</h2>
                    <p style="color: #00ff88;">Arsenal disponível: <span id="estoque-num">${produto.estoque}</span> unidades</p>
                    
                    <div class="qtd-container">
                        <span>Quantidade:</span>
                        <input type="number" id="qtd-compra" value="1" min="1" max="${produto.estoque}">
                    </div>

                    <div class="frete-box">
                        <p><i class="fas fa-truck"></i> Simular Frete</p>
                        <div style="display: flex; gap: 10px;">
                            <input type="text" id="cep" placeholder="00000-000" style="margin:0; flex:1; background:#000; border:1px solid #444; color:#fff; padding:10px; border-radius:5px;">
                            <button class="btn" onclick="calcularFrete()">CALCULAR</button>
                        </div>
                        <p id="res-frete" style="margin-top:10px; font-weight:bold;"></p>
                    </div>

                    <button class="btn" style="width: 100%; margin-top: 20px; font-size: 1.2rem;" onclick="comprar(${produto.id})">
                        ADICIONAR AO CARRINHO <i class="fas fa-shopping-cart"></i>
                    </button>
                </div>
            `;
        }

        function calcularFrete() {
            const cep = document.getElementById('cep').value;
            if(cep.length < 8) return alert("CEP Inválido");
            const valor = (Math.random() * (40 - 15) + 15).toFixed(2);
            document.getElementById('res-frete').innerText = `Frete para ${cep}: R$ ${valor} (Entrega em 3 dias)`;
            sessionStorage.setItem('frete_atual', valor);
        }

        function comprar(id) {
            let produtos = JSON.parse(localStorage.getItem(DATABASE_KEY)) || [];
            const pIndex = produtos.findIndex(item => item.id == id);
            
            if (pIndex === -1) return alert("Erro ao localizar produto.");
            
            const p = produtos[pIndex];
            const inputQtd = document.getElementById('qtd-compra');
            const qtdDesejada = parseInt(inputQtd.value);

            if(p.estoque < qtdDesejada) return alert("Quantidade indisponível no estoque!");

            let carrinho = JSON.parse(localStorage.getItem('carrinho')) || [];
            const frete = parseFloat(sessionStorage.getItem('frete_atual')) || 0;

            const itemExistente = carrinho.find(item => item.id == id);

            if(itemExistente) {
                itemExistente.quantidade += qtdDesejada;
                itemExistente.freteAcumulado += frete;
            } else {
                carrinho.push({
                    id: p.id,
                    nome: p.nome,
                    preco: p.preco,
                    custo: p.custo,
                    img1: p.img1,
                    quantidade: qtdDesejada,
                    freteAcumulado: frete
                });
            }

            // ATUALIZAÇÃO CRÍTICA: Salva a baixa do estoque no banco principal
            produtos[pIndex].estoque -= qtdDesejada;
            localStorage.setItem(DATABASE_KEY, JSON.stringify(produtos));
            localStorage.setItem('carrinho', JSON.stringify(carrinho));
            
            alert(`${qtdDesejada} unidade(s) adicionada(s) ao seu arsenal de compras!`);
            window.location.href = "carrinho.html";
        }

        window.onload = carregarProduto;
    </script>
</body>
</html>
