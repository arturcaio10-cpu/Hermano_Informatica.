<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="UTF-8">
    <title>Hermano Info - Vitrine</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .card { cursor: pointer; transition: transform 0.3s, box-shadow 0.3s; position: relative; display: flex; flex-direction: column; height: 100%; }
        .card:hover { transform: translateY(-5px); box-shadow: 0 10px 20px rgba(0, 212, 255, 0.2); }
        
        .img-container { 
            width: 100%; 
            height: 180px; 
            overflow: hidden; 
            border-radius: 10px; 
            margin-bottom: 12px; 
            background: #111;
        }
        .card img { 
            width: 100%; 
            height: 100%; 
            object-fit: cover; 
            transition: opacity 0.4s ease; 
        }

        .btn-detalhes { background: rgba(255,255,255,0.1); color: #fff; border: 1px solid rgba(255,255,255,0.1); font-size: 0.8rem; }
        
        .badge-estoque {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #ff4b2b;
            color: white;
            padding: 4px 8px;
            border-radius: 5px;
            font-size: 0.6rem;
            font-family: 'Orbitron';
            z-index: 2;
        }

        /* AJUSTES PARA CELULAR */
        @media (max-width: 600px) {
            .produto-grid {
                grid-template-columns: 1fr 1fr;
                gap: 10px;
                padding: 10px;
            }
            .img-container { height: 140px; }
            .card h3 { font-size: 0.9rem; margin: 5px 0; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
            .card p.desc-curta { display: none; } 
            .preco-vitrine { font-size: 1.1rem !important; }
            .btn-detalhes { padding: 8px; font-size: 0.7rem; }
            .input-qtd-mobile { width: 40px !important; font-size: 0.8rem !important; }
        }
    </style>
</head>
<body>
    <header>
        <h1 class="logo">HERMANO INFO</h1>
        <nav>
            <a href="index.html">Início</a>
            <a href="login.html">Admin</a>
            <a href="carrinho.html" class="carrinho-link">
                <i class="fas fa-shopping-cart"></i> 
                <span id="cart-count" class="badge">0</span>
            </a>
        </nav>
    </header>

    <main>
        <h2 style="font-family: 'Orbitron'; color: #00d4ff; text-align: center; text-transform: uppercase; letter-spacing: 2px; margin: 20px 0; font-size: 1.2rem;">
            Arsenal Tecnológico
        </h2>
        
        <div id="vitrine" class="produto-grid"></div>
    </main>

    <script>
    // CHAVE PADRONIZADA COM O ADMIN
    const DATABASE_KEY = 'produtos_loja';

    function atualizarBadge() {
        const cartCount = document.getElementById('cart-count');
        const carrinho = JSON.parse(localStorage.getItem('carrinho')) || [];
        const totalItens = carrinho.reduce((sum, item) => sum + item.quantidade, 0);
        cartCount.innerText = totalItens;
    }

    function carregarProdutos() {
        const vitrine = document.getElementById('vitrine');
        // Agora busca apenas na chave principal produtos_loja
        let produtos = JSON.parse(localStorage.getItem(DATABASE_KEY)) || [];
        
        vitrine.innerHTML = '';
        atualizarBadge();

        if (produtos.length === 0) {
            vitrine.innerHTML = '<p style="text-align:center; grid-column: 1/-1; color:#888;">Nenhum item no arsenal no momento.</p>';
            return;
        }

        produtos.forEach((prod) => {
            if (prod.estoque > 0) {
                const avisoEstoque = prod.estoque <= 2 ? `<div class="badge-estoque">FALTAM ${prod.estoque}</div>` : '';
                const imgSecundaria = prod.img2 || prod.img1;

                vitrine.innerHTML += `
                    <div class="card" onclick="irParaProduto(${prod.id})">
                        ${avisoEstoque}
                        <div class="img-container">
                            <img src="${prod.img1}" 
                                 id="img-${prod.id}" 
                                 onmouseover="this.src='${imgSecundaria}'" 
                                 onmouseout="this.src='${prod.img1}'"
                                 alt="${prod.nome}">
                        </div>
                        <h3>${prod.nome}</h3>
                        <p class="desc-curta" style="font-size: 0.75rem; color: #888; height: 30px; overflow: hidden; margin-bottom: 5px;">
                            ${prod.detalhes || ''}
                        </p>
                        <p class="preco-vitrine" style="color: #00d4ff; font-weight: bold; font-size: 1.3rem; margin: 5px 0;">R$ ${Number(prod.preco).toFixed(2)}</p>
                        
                        <div style="display: flex; flex-direction: column; gap: 5px; margin-top: auto;" onclick="event.stopPropagation()">
                            <button class="btn btn-detalhes" onclick="irParaProduto(${prod.id})">
                                <i class="fas fa-eye"></i> DETALHES
                            </button>
                            <div style="display: flex; gap: 5px;">
                                <input type="number" id="qtd-compra-${prod.id}" value="1" min="1" max="${prod.estoque}" 
                                    class="input-qtd-mobile"
                                    style="width: 50px; background: #000; color: #fff; border: 1px solid #333; text-align: center; border-radius: 5px;">
                                <button class="btn" onclick="comprar(${prod.id})" style="flex: 1; padding: 10px; font-size: 0.8rem;">
                                    <i class="fas fa-cart-plus"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }
        });
    }

    function irParaProduto(id) {
        window.location.href = `produto.html?id=${id}`;
    }

    function comprar(id) {
        let produtos = JSON.parse(localStorage.getItem(DATABASE_KEY)) || [];
        let carrinho = JSON.parse(localStorage.getItem('carrinho')) || [];
        const index = produtos.findIndex(p => p.id === id);
        
        const inputQtd = document.getElementById(`qtd-compra-${id}`);
        const qtdDesejada = parseInt(inputQtd.value);
        
        if (index !== -1) {
            if (produtos[index].estoque >= qtdDesejada) {
                // Diminui o estoque no "Banco de Dados"
                produtos[index].estoque -= qtdDesejada;
                
                const itemExistente = carrinho.find(item => item.id === id);
                if (itemExistente) {
                    itemExistente.quantidade += qtdDesejada;
                } else {
                    carrinho.push({ 
                        id: produtos[index].id,
                        nome: produtos[index].nome, 
                        preco: produtos[index].preco,
                        custo: produtos[index].custo || 0,
                        quantidade: qtdDesejada,
                        img1: produtos[index].img1,
                        freteAcumulado: 0
                    });
                }
                
                // Salva ambos de volta com a chave correta
                localStorage.setItem(DATABASE_KEY, JSON.stringify(produtos));
                localStorage.setItem('carrinho', JSON.stringify(carrinho));
                
                atualizarBadge();
                carregarProdutos();
                alert("Arsenal atualizado! Item no carrinho.");
            } else {
                alert("Estoque insuficiente!");
            }
        }
    }

    window.onload = carregarProdutos;
    </script>
</body>
</html>
